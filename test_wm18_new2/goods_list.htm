{include file="common/header.htm"}
{include file="common/fuzhi.htm"}
<div id="contentBox">
     <div class="titleList">
     	  <div class="col-md-7">


               <div class="btn-group">
                    <button type="button" class="btn btn-danger button_delete_all"><i class="glyphicon glyphicon-trash"></i>删除</button>
                    <button type="button" class="btn btn-success button_goods_add"><i class="glyphicon glyphicon-plus"></i>新增</button>
               </div>
               <div class="btn-group">
                    <button type="button" class="btn btn-default sale_on_name dropdown-toggle" data-toggle="dropdown">批量操作</button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu sale_on_list" role="menu">
                        <li attr_id="1" attr_name=" 上架 &nbsp; &nbsp; &nbsp;"><a> 上架 </a></li>
                        <li attr_id="0" attr_name=" 下架 &nbsp; &nbsp; &nbsp;"><a> 下架 </a></li>
						<li attr_id="3" attr_name=" 批量显示 &nbsp; &nbsp; &nbsp;"><a> 批量显示 </a></li>
						<li attr_id="2" attr_name=" 批量隐藏 &nbsp; &nbsp; &nbsp;"><a> 批量隐藏 </a></li>
						<li attr_id="4" attr_name=" 批量删除 &nbsp; &nbsp; &nbsp;"><a> 批量删除 </a></li>
                        <li class="batch_category" attr_id="5" attr_name=" 修改分类 &nbsp; &nbsp; &nbsp;"><a> 修改分类 </a></li>
                    </ul>
               </div>
               <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                    {if $type eq is_show or $type eq ''}
                    出售中的商品
                    {elseif $type eq is_show_no_sell_on}
                    审核未上架
                    {elseif $type eq sell_out}
                    已售罄的商品
                    {elseif $type eq is_show_no}
                    未审核的商品
                    {/if}
                    </button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="goods.php?act=list&type=is_show">出售中的商品</a></li>
                        <li><a href="goods.php?act=list&type=is_show_no_sell_on">审核未上架</a></li>
                        <li><a href="goods.php?act=list&type=sell_out">已售罄的商品</a></li>
                        <li><a href="goods.php?act=list&type=is_show_no">未审核的商品</a></li>
                    </ul>
               </div>
               <div class="btn-group">
               		<button type="button" class="btn btn-default dropdown-toggle"  data-toggle="dropdown"><b>{if $cat_name2}{$cat_name2}{else}自定义分类筛选{/if}</b></button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu cat_search_list" role="menu">
                    <li attr_id="0" attr_name="全部分类"><a alt="0">全部分类</a></li>
                    {foreach from=$cate_list item=info1}

    <li attr_id="{$info1.cat_id}" attr_name="{$info1.cat_name}"><a alt="0">{$info1.cat_name}</a></li>
    {foreach from=$info1.list item=info2}
    <li attr_id="{$info2.cat_id}" attr_name="{$info2.cat_name}"><a alt="0">—| {$info2.cat_name}</a></li>
    {/foreach}
     <li role="presentation" class="divider"></li>
{/foreach}
                    </ul>

               </div>
               &nbsp; <button type="button" class="btn btn-warning button_cvs">
                  <i class="glyphicon glyphicon-save"></i>导出商品</button>
          </div>
          <div class="col-md-5">
          <form action="goods.php" id="search_form">

               <div class="input-group">
                    <input class="form-control" type="text" placeholder="请输入关键词" name="keyword" value="{$keyword}">
                    <span class="input-group-btn"><button class="btn btn-info" type="submit">搜索</button></span>
               </div>
               <div class="btn-group" style="float:right; margin-right:5px;">
               		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><b class="search_type_name">{if $keyword_type eq 1 or $keyword_type eq ''}商品名称{else}商品货号{/if}</b></button>
                    <input type="hidden" name="act" value="list"/>
                    <input type="hidden" name="type" value="{if $type}{$type}{else}is_show{/if}"/>
                    <input type="hidden" name="cat_id" id="cat_id" value=""/>
                    <input type="hidden" name="keyword_type" id="keyword_type" value="{if $keyword_type}{$keyword_type}{else}1{/if}"/>

                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                    <ul class="dropdown-menu search_type_list" role="menu">
                        <li attr_id="1" attr_name="商品名称"><a>商品名称</a></li>
                        <li attr_id="2" attr_name="商品货号"><a>商品货号</a></li>
                    </ul>
               </div>
               </form>
          </div>
          <div class="clear"></div>
     </div>
     <div id="goodsLabelList">
          <table width="100%" border="0" cellspacing="0" cellpadding="0">
              <thead>
                  <tr>
                    <th width="80"><input type="checkbox" onclick="check()" id="click"></th>
                    <th width="220">商品名称<i class="glyphicon glyphicon-sort" onclick="sort_goods_name()" id="goods_name_sort" data="{$goods_name_sort}"></i></th>
                    <th width="100">商品编码</th>
                    <th width="70">PV</th>
                    <th width="70">所属分类</th>
                    <th width="90">价格<!--<i class="glyphicon glyphicon-sort"></i>--></th>
                    <th width="70">总库存<i class="glyphicon glyphicon-sort" onclick="sort_goods_number()" id="number" data="{$sort}"></i></th>
                    <th width="70">总销量<i class="glyphicon glyphicon-sort" onclick="sort_goods_sale_number()" id="sale_number" data="{$sale_number}"></i></th>
                    <th width="120">时间<i class="glyphicon glyphicon-sort" onclick="sort_goods_time()" id="goods_time" data="{$goods_time}"></i></th>
                    <th width="50">上架</th>
                    <th width="50">显示</th>
                    <th width="60">排序<!--<i class="glyphicon glyphicon-sort"></i>--></th>
                    <th width="70"></th>
                  </tr>
              </thead>
              <tbody>
               {foreach from=$info item=info2}
                  <tr>
                    <td><input type="checkbox" class="amount" name="box"  value="{$info2.goods_info.goods_id}">{$info2.goods_info.goods_id}</td>
                    <td>{if $info2.buy_quick eq 1}<b class="tuanFont">抢</b>{/if}<a href="{$site_url}goods.php?act=info&id={$info2.goods_info.goods_id}" target="_blank"><img src="{$base_url}{$info2.goods_info.goods_thumb}" height="30"></a>　<a href="{$site_url}goods.php?act=info&id={$info2.goods_info.goods_id}" target="_blank">{$info2.goods_info.goods_name}</a></td>
                    <td>{$info2.goods_info.goods_sn}</td>
                    <td>{$info2.goods_info.pv}<i class="glyphicon glyphicon-cog" onClick="layer_edit({$info2.goods_info.goods_id})"></i></td>
                    <td>{$info2.cat_name}</td>
                    <td>￥{$info2.goods_info.shop_price}<i class="glyphicon glyphicon-cog" onClick="layer_edit({$info2.goods_info.goods_id})"></i></td>
                    <td>{$info2.goods_info.goods_number}<i class="glyphicon glyphicon-cog" onClick="layer_edit({$info2.goods_info.goods_id})"></i></td>
                    <td>{$info2.paysalesnum}</td>
                    <td>{$info2.time}</td>
                    <td><i class="is_on_sale glyphicon {if $info2.goods_info.is_on_sale eq 1}glyphicon-ok{else}glyphicon glyphicon-remove{/if}" attr_id="{$info2.goods_info.goods_id}" id="is_on_sale_{$info2.goods_info.goods_id}"></i></td>
                    <td><i class="is_show glyphicon {if $info2.goods_info.is_show eq 1}glyphicon-ok{else}glyphicon glyphicon-remove{/if}" attr_id="{$info2.goods_info.goods_id}" id="is_show_{$info2.goods_info.goods_id}"></i></td>
                    <td>{$info2.sort_order}<i class="glyphicon glyphicon-cog" onClick="layer_edit({$info2.goods_info.goods_id})"></i></td>
                    <td style="padding-left:2px;"><span>
                        <a href="goods.php?act=edit&goods_id={$info2.goods_info.goods_id}" class="glyphicon glyphicon-pencil" title="编辑"></a>
                        <a class="glyphicon glyphicon-share spread" title="推广" goods_id="{$info2.goods_info.goods_id}"></a>
                        <a class="glyphicon glyphicon-trash delete_item" title="删除" goods_id="{$info2.goods_info.goods_id}"></a>
                    </span></td>
                  </tr>
                  {/foreach}

              </tbody>
          </table>
     </div>
     <!--分页-->
     <div id="">{$page_bar}</div>
     <!--添加-->
     <div class="prompt addClass">
     	  <div class="promptTitle"><span class="glyphicon glyphicon-th-large"></span>编辑属性<i class="glyphicon glyphicon-remove" onClick="promptClose('.prompt.addClass')"></i></div>
          <div class="promptContent">
               <table width="100%" border="0" cellspacing="0" cellpadding="0">

                    <tr>
                      <td width="75">商品名称</td>
                      <td><input type="text" class="form-control" id="layer_goods_name"></td>
                      <td width="20" align="center"><span>*</span></td>
                    </tr>
                    <tr>
                      <td>所属分类</td>
                      <td>
                      	  <div class="btn-group">
                               <button class="btn btn-default" data-toggle="dropdown"><b class="parent_name">一级分组</b> <i class="caret"></i></button>
                               <ul class="dropdown-menu layer_class_list" role="menu" id="goodClassNew2">
                                    <input type="hidden" class="val" value="">
                                    {foreach from=$cate_list item=info1}
                                    <li attr_id="{$info1.cat_id}" attr_name="{$info1.cat_name}"><a alt="0">{$info1.cat_name}</a></li>
                                    	 {foreach from=$info1.list item=info2}
                                         <li attr_id="{$info2.cat_id}" attr_name="{$info2.cat_name}"><a alt="0">—| {$info2.cat_name}</a></li>
                                         {/foreach}
                                    {/foreach}

                               </ul>
                          </div>
                      </td>
                      <td>&nbsp;</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td align="2"><div class="goodClassNew2" style="width:100%;"></div></td>
                    </tr>
                    <tr>
                      <td width="75">价格</td>
                      <td><input type="text" class="form-control" id="layer_shop_price"></td>
                      <td align="center"><span>*</span></td>
                    </tr>
                     <tr>
                      <td width="75">PV</td>
                      <td><input type="text" class="form-control" id="layer_pv"></td>
                      <td align="center"><span>*</span></td>
                    </tr>
                    <tr>
                      <td width="75">总库存</td>
                      <td><input type="number" class="form-control" id="layer_goods_number"></td>
                      <td align="center"><span>*</span></td>
                    </tr>
                    <tr>
                      <td width="75">排序</td>
                      <td><input type="number" class="form-control" id="layer_sort_order"></td>
                      <td align="center"><span>*</span></td>
                    </tr>
               </table>
          </div>
          		<script>
				$('#goodClassNew2 li').click(function(){
					var html = $(this).attr('attr_name'); 
					var id   = $(this).attr('attr_id');
					var li   = $('.goodClassNew2 li').length;
					var v    = true;
					for(var i=0;i<=li;i++){
						var pid = $('.goodClassNew2 li').eq(i).find('input').attr('value');
						if(pid == id){
							var v = false;
						}
					}
					if(id != 0 && v == true){
						$('.goodClassNew2').append('<li>'+html+'<input type="hidden" value="'+id+'"><span onClick="goodClassNewDelete($(this))">X</span></li>')
					}
				})
				function goodClassNewDelete(id){
					id.parent().remove(); 
				}
                </script>
          <div class="promptBottom">
               <input type="hidden" name="goods_id_edit"/>
               <input type="hidden" name="parent_id" id="parent_id">
          	   <button type="button" class="btn btn-info button_layer_save">保　存</button>
               <button type="button" class="btn btn-danger" onClick="promptClose('.prompt.addClass')">取　消</button>
          </div>
     </div>
     <div class="prompt share">
     	  <div class="promptTitle"><span class="glyphicon glyphicon-th-large"></span>分享<i class="glyphicon glyphicon-remove" onClick="promptClose('.prompt.share')"></i></div>
          <div class="promptContent">
               <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="95">领取链接：</td>
                      <td class="buy_link"><input type="text" class="buy_link_val form-control"/></td>
                      <td width="30" align="center"><button type="button" class="btn btn-info copyBtn">复制链接</button></td>
                    </tr>
                    <tr>
                      <td>领取二维码：</td>
                      <td><img src="{$site_url}resource/images/loadding.gif" width="181" class="goodsRQ"></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td colspan="3">可通过公众号群发消息、图文消息、自定义菜单等方式灵活投放优惠券</td>
                    </tr>
               </table>
          </div>
          <div class="promptBottom" style="padding-left:117px;"><button type="button" class="btn btn-danger" onClick="promptClose('.prompt.share')">关闭</button></div>
     </div>
     <!--修改分类-->
     <div class="prompt batClass">
     	  <div class="promptTitle"><span class="glyphicon glyphicon-th-large"></span>修改分类<i class="glyphicon glyphicon-remove" onClick="promptClose('.prompt.batClass')"></i></div>
          <div class="promptContent">
               <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="75">分类</td>
                      <td>
                      	  <div class="btn-group">
                               <button class="btn btn-default" data-toggle="dropdown"><b class="parent_name">一级分组</b> <i class="caret"></i></button>
                               <ul class="dropdown-menu layer_class_list" role="menu" id="goodClassNew">
                                    <input type="hidden" class="val" value="">
                                    {foreach from=$cate_list item=info1}
                                    <li attr_id="{$info1.cat_id}" attr_name="{$info1.cat_name}"><a alt="0">{$info1.cat_name}</a></li>
                                    	 {foreach from=$info1.list item=info2}
                                         <li attr_id="{$info2.cat_id}" attr_name="{$info2.cat_name}"><a alt="0">—| {$info2.cat_name}</a></li>
                                         {/foreach}
                                    {/foreach}

                               </ul>
                          </div>
                      </td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><div class="goodClassNew"></div></td>
                    </tr>
               </table>
          </div>
          <div class="promptBottom">
          	   <button type="button" class="btn btn-info button_batch_category_save">保　存</button>
               <button type="button" class="btn btn-danger" onClick="promptClose('.prompt.batClass')">取　消</button>
          </div>
          		<script>
				$('#goodClassNew li').click(function(){
					var html = $(this).attr('attr_name'); 
					var id   = $(this).attr('attr_id');
					var li   = $('.goodClassNew li').length;
					var v    = true;
					for(var i=0;i<=li;i++){
						var pid = $('.goodClassNew li').eq(i).find('input').attr('value');
						if(pid == id){
							var v = false;
						}
					}
					if(id != 0 && v == true){
						$('.goodClassNew').append('<li>'+html+'<input type="hidden" name="cat_arr[]" value="'+id+'"><span onClick="goodClassNewDelete($(this))">X</span></li>')
					}
				})
				function goodClassNewDelete(id){
					id.parent().remove(); 
				}
                </script>
     </div>
</div>
<div id="bg"></div>
<script type="text/javascript">
//弹出层保存
function layer_edit(goods_id)
{
    $("input[name='goods_id_edit']").val(goods_id);
    promptOpen('.prompt.addClass');
    $.post("goods.php?act=ajax_get_goods_info",{"goods_id":goods_id},function (res)
    {
        $("#layer_goods_name").val(res.info.goods_name);
        $("#layer_shop_price").val(res.info.shop_price);
		$("#layer_pv").val(res.info.pv);
        $("#layer_goods_number").val(res.info.goods_number);
        $("#layer_sort_order").val(res.info.sort_order);
		if(res.cat_info.cat_name)
		$(".parent_name").html(res.cat_info.cat_name);
    },"json");
}
function getQueryString(name) {
	var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
	var r = window.location.search.substr(1).match(reg);
	if (r != null) return unescape(r[2]); return null;
}
function sort_goods_number()
{
	  $qq = $("#number").attr("data");
      url_search=window.location.search;
      url_search=url_search.replace(/&sort=\d+/g,"");
      url_search=url_search.replace(/&page=\d+/g,"");
      url_search=url_search.replace(/&sale_number=\d+/g,"");
	  url_search=url_search.replace(/&goods_name_sort=\d+/g,"");
	  url_search=url_search.replace(/&goods_time=\d+/g,"");
      url_search=url_search.replace(/&sort=/g,"");
	  url_search=url_search.replace(/&goods_name_sort=/g,"");
      url_search=url_search.replace(/&sale_number=/g,"");
	  url_search=url_search.replace(/&goods_time=/g,"");
		if($qq==1){
			ss = getQueryString("sort");
			if(ss > 0){
				 url = "goods.php"+url_search+"&sort=1";
			$("#number").attr("data",2);
			window.location.href=url;
					}else{
						url = "goods.php"+url_search+"&sort=1";
			$("#number").attr("data",2);
			window.location.href=url;
						}

			}else{
				url = "goods.php"+url_search+"&sort=2";
			$("#number").attr("data",1);
			window.location.href=url;
				}
}
function sort_goods_name()
{
	  $qq = $("#goods_name_sort").attr("data");
      url_search=window.location.search;
	   console.log(url_search+"---11");
      url_search=url_search.replace(/&sort=\d+/g,"");
      url_search=url_search.replace(/&page=\d+/g,"");
      url_search=url_search.replace(/&sale_number=\d+/g,"");
	  url_search=url_search.replace(/&goods_name_sort=\d+/g,"");
	  url_search=url_search.replace(/&goods_time=\d+/g,"");
      url_search=url_search.replace(/&sort=/g,"");
      url_search=url_search.replace(/&goods_name_sort=/g,"");
      url_search=url_search.replace(/&sale_number=/g,"");
	  url_search=url_search.replace(/&goods_time=/g,"");
	  console.log(url_search);

	 
		if($qq==1){
			ss = getQueryString("goods_name_sort");
			if(ss > 0){
				 url = "goods.php"+url_search+"&goods_name_sort=2";
			$("#goods_name_sort").attr("data",2);
			window.location.href=url;
					}else{
						url = "goods.php"+url_search+"&goods_name_sort=2";
			$("#goods_name_sort").attr("data",2);
			window.location.href=url;
						}

			}else{
				url = "goods.php"+url_search+"&goods_name_sort=1";
				 console.log(url);
			$("#goods_name_sort").attr("data",1);
			window.location.href=url;
				}
}
function sort_goods_sale_number()
{
    $qq = $("#sale_number").attr("data");
    url_search=window.location.search;
    url_search=url_search.replace(/&sort=\d+/g,"");
    url_search=url_search.replace(/&page=\d+/g,"");
    url_search=url_search.replace(/&sale_number=\d+/g,"");
	url_search=url_search.replace(/&goods_name_sort=\d+/g,"");
	url_search=url_search.replace(/&goods_time=\d+/g,"");
    url_search=url_search.replace(/&sort=/g,"");
	url_search=url_search.replace(/&goods_name_sort=/g,"");
    url_search=url_search.replace(/&sale_number=/g,"");
	url_search=url_search.replace(/&goods_time=/g,"");
    if($qq==1){
        ss = getQueryString("sale_number");
        if(ss > 0){
            url = "goods.php"+url_search+"&sale_number=1";
            $("#sale_number").attr("data",2);
            window.location.href=url;
        }else{
            url = "goods.php"+url_search+"&sale_number=1";
            $("#sale_number").attr("data",2);
            window.location.href=url;
        }

    }else{
        url = "goods.php"+url_search+"&sale_number=2";
        $("#sale_number").attr("data",1);
        window.location.href=url;
    }
}
function sort_goods_time()
{
    $qq = $("#goods_time").attr("data");
    url_search=window.location.search;
    url_search=url_search.replace(/&sort=\d+/g,"");
	url_search=url_search.replace(/&sale_number=\d+/g,"");
	url_search=url_search.replace(/&goods_name_sort=\d+/g,"");
    url_search=url_search.replace(/&page=\d+/g,"");
    url_search=url_search.replace(/&goods_time=\d+/g,"");
    url_search=url_search.replace(/&sort=/g,"");
	url_search=url_search.replace(/&goods_name_sort=/g,"");
    url_search=url_search.replace(/&goods_time=/g,"");
	url_search=url_search.replace(/&sale_number=/g,"");
    if($qq==1){
        ss = getQueryString("goods_time");
        if(ss > 0){
            url = "goods.php"+url_search+"&goods_time=1";
            $("#goods_time").attr("data",2);
            window.location.href=url;
        }else{
            url = "goods.php"+url_search+"&goods_time=1";
            $("#goods_time").attr("data",2);
            window.location.href=url;
        }

    }else{
        url = "goods.php"+url_search+"&goods_time=2";
        $("#goods_time").attr("data",1);
        window.location.href=url;
    }
}
$(".batch_category").click(function ()
{

})
$(".button_layer_save").click(function ()
{

    goods_id=$("input[name='goods_id_edit']").val();
    goods_name=$("#layer_goods_name").val();
    shop_price=$("#layer_shop_price").val();
	pv=$("#layer_pv").val();
    goods_number=$("#layer_goods_number").val();
    sort_order=$("#layer_sort_order").val();
  	if(shop_price=="")
  	{
	 	 alert("请输入商品售价!");return false;
 	}
 	if(parseInt(pv)>0 && parseInt(shop_price)<parseInt(pv))
 	{
	 	 alert("pv值不能大于商品售价!");return false;
  	}
  
	parent_id=$("#parent_id").val();
    data={"act":"ajax_layer_save","goods_id":goods_id,"goods_name":goods_name,"shop_price":shop_price,"pv":pv,"goods_number":goods_number,"sort_order":sort_order,"cat_id":parent_id};
    $.post("goods.php",data,function (res)
        {
            promptClose('.prompt.addClass');
			location.reload();
        },"json")
})
//表单查询
$(".button_goods_add").click(function ()
{
	location.href="goods.php?act=add";
})
$(function(){
  $(".delete_item").each(function ()
  {
     $(this).click(function ()
     {
         goods_id=$(this).attr("goods_id");
         if(confirm("该操作不可恢复")){
          $.post("goods.php?act=ajax_goods_delete",{"goods_id":goods_id},function (res)
              {
                location.reload();
              },"json");
          }
          return false;
     })
  })
	 //批量删除
  $(".button_delete_all").click(function ()
  {
    var check = $(".amount:checked");
    if(check.length<1){
      alert('请选择要删除的项目');
    }
    else
    {
    if(confirm("确认要删除吗?"))
    {
      var id = '';
      check.each(function(i){
        if($(this).val())
        {
          id=id+$(this).val()+";";
        }
      });
      $.post("goods.php",{"act":"ajax_goods_delete","goods_id":id},function(res){
        if(res.error==1)
        alert(res.info);
        else
        {
          //alert(res.info);
          location.reload();
        }
      },"json");
    }
    else
    return false;
    }
  })
 //批量上下架
 $(".sale_on_list li").each(function ()
  {
    $(this).click(function ()
    {
        attr_id=$(this).attr("attr_id");
		 attr_name=$(this).attr("attr_name");
		$(".sale_on_name").html(attr_name);

		 var check = $(".amount:checked");
		if(check.length<1){
			alert('请选择商品');
		}else if(attr_id == 2){
			var id = '';
			check.each(function(i){
			if($(this).val())
			{
			  id=id+$(this).val()+";";
			}
			});
			if(confirm("确认要隐藏商品吗?"))
			{
			var id = '';
			check.each(function(i){
				if($(this).val())
				{
					id=id+$(this).val()+";";
				}
			});
			$.post("goods.php",{act:"ajax_sale_on","id":id},function(res){
				if(res.error==1)
				alert(res.info);
				else
				{
					alert(res.info);
					location.reload();
				}
			},"json");
			}
			else
			return false;
		}
		else if(attr_id == 3){
			var id = '';
			check.each(function(i){
			if($(this).val())
			{
			  id=id+$(this).val()+";";
			}
			});
			if(confirm("确认要显示商品吗?"))
			{
			var id = '';
			check.each(function(i){
				if($(this).val())
				{
					id=id+$(this).val()+";";
				}
			});
			$.post("goods.php",{act:"ajax_sale_on_show","id":id},function(res){
				if(res.error==1)
				alert(res.info);
				else
				{
					alert(res.info);
					location.reload();
				}
			},"json");
			}
			else
			return false;
		}
		else if(attr_id == 4){
			var id = '';
			check.each(function(i){
			if($(this).val())
			{
			  id=id+$(this).val()+";";
			}
			});
			if(confirm("确认要删除商品吗?"))
			{
			var id = '';
			check.each(function(i){
				if($(this).val())
				{
					id=id+$(this).val()+";";
				}
			});
			$.post("goods.php",{act:"ajax_delete_all","id":id},function(res){
				if(res.error==1)
				alert(res.info);
				else
				{
					//alert(res.info);
					location.reload();
				}
			},"json");
			}
			else
			return false;
			//}
		  //},"json");
		}
    else if(attr_id == 5){
      var id = '';
      check.each(function(i){
        if($(this).val())
        {
          id=id+$(this).val()+";";
        }
      });
      $(".button_batch_category_save").attr("id",id);
      promptOpen('.prompt.batClass'); 
    }
		else
		{
		if(confirm("确认要上下架吗?"))
		{
		  var id = '';
		  check.each(function(i){
			if($(this).val())
			{
			  id=id+$(this).val()+";";
			}
		  });
		  $.post("goods.php",{"act":"ajax_goods_is_on_sale","goods_id":id,"is_on_sale":attr_id},function(res){
			if(res.error==1)
			alert(res.info);
			else
			{
			  //alert(res.info);
			  location.reload();
			}
		  },"json");
		}
		else
		return false;
		}
    })
  })

 //上下架
 $(".is_on_sale").each(function ()
  {
    $(this).click(function ()
    {
        attr_id=$(this).attr("attr_id");
        data={"goods_id":attr_id,"act":"ajax_is_on_sale"}
        $.post("goods.php",data,function (res)
        {
           if(res.info==1)
		   {
			   $("#is_on_sale_"+res.goods_id).removeClass("glyphicon-remove");
			   $("#is_on_sale_"+res.goods_id).addClass("glyphicon-ok");
		   }
		   else
		   {
			   $("#is_on_sale_"+res.goods_id).removeClass("glyphicon-ok");
			   $("#is_on_sale_"+res.goods_id).addClass("glyphicon-remove");
		   }
        },"json")
    })
  })
   //显示
 $(".is_show").each(function ()
  {
    $(this).click(function ()
    {
        attr_id=$(this).attr("attr_id");
        data={"goods_id":attr_id,"act":"ajax_is_show"}
        $.post("goods.php",data,function (res)
        {
           if(res.info==1)
		   {
			   $("#is_show_"+res.goods_id).removeClass("glyphicon-remove");
			   $("#is_show_"+res.goods_id).addClass("glyphicon-ok");
		   }
		   else
		   {
			   $("#is_show_"+res.goods_id).removeClass("glyphicon-ok");
			   $("#is_show_"+res.goods_id).addClass("glyphicon-remove");
		   }
        },"json")
    })
  })
 //自定义分类筛选
 $(".cat_search_list li").each(function ()
  {
    $(this).click(function ()
    {
        attr_id=$(this).attr("attr_id");
        $("#cat_id").val(attr_id);
        $("#search_form").submit();
    })
  })
   //搜索筛选
 $(".search_type_list li").each(function ()
  {
    $(this).click(function ()
    {
        attr_id=$(this).attr("attr_id");
        attr_name=$(this).attr("attr_name");
		$(".search_type_name").html(attr_name);
		$("#keyword_type").val(attr_id);
    })
  })
  $(".layer_class_list li").each(function ()
  {
    $(this).click(function ()
    {
        attr_id=$(this).attr("attr_id");
        attr_name=$(this).attr("attr_name");
        $("#parent_id").val(attr_id);
        $(".parent_name").html(attr_name);
    })
  })


  $('.spread').click(function(event) {
      goods_id=$(this).attr("goods_id");
      promptOpen('.prompt.share');
	  
	  $(".buy_link_val").val('加载中...');
	  $(".goodsRQ").attr("src","{$site_url}resource/images/loadding.gif");
      data={"goods_id":goods_id,"act":"create_qRcode"}
      if($(this).attr("QR_create")!=1)
      {
        $.post("goods.php",data,function (res)
        {
          $(".goodsRQ").attr("src",res.pic);
          //$(".buy_link").html(res.buy_link);
		  $(".buy_link_val").val(res.buy_link);

        },"json")
      }

    });
  //复制
    $('.copyBtn').click(function(){
    var e = $('.buy_link_val');
    e.select();
    document.execCommand("Copy");
    $('.copy').eq($(this).index('.copyBtn')).css('display','none');
    alert('成功复制');
  })

})
function check(){
	var checkbox=document.getElementById('click')
	checkbox.value==2?checkbox.value=1:checkbox.value=2;
	var amount=document.getElementsByName('box');
	for(var i=0;i<amount.length;i++){
		if(checkbox.value==1){
			amount[i].checked=false;
		}else{
			amount[i].checked=true;
		}
	}
}

$(".button_batch_category_save").click(function ()
{
    str="";
    cate_hidden=$(".goodClassNew").find("input");
    for(var i=0;i<cate_hidden.length;i++){
         str=str+cate_hidden.eq(i).val()+",";
    }
    id=$(this).attr("id");
    str=(str) ? ","+str : "";
    data={"act":"ajax_batch_category","batch_category":str,"id":id}
    $.post("goods.php",data,function (res)
        {
          promptClose('.prompt.batClass');
          location.reload();

    },"json")
})
$(".button_cvs").click(function ()
{
	url_search=window.location.search;
    var s = url_search.indexOf("?");
    console.log(s);
    if(s>=0)
    url=url_search+"&act=import_goods_cvs";
    else
    url="goods.php?act=import_goods_cvs";
    location.href=url;
})
</script>
{include file="common/footer.htm"}